# This file is part of the RobinHood Library
# Copyright (C) 2025 Commissariat a l'energie atomique et aux energies
#                    alternatives
#
# SPDX-License-Identifer: LGPL-3.0-or-later

extra_sources = []
extra_dependencies = []

libdl = cc.find_library('dl', required: false)

if build_mfu or build_s3_mpi
    extra_sources += ['mpi_rc.c']
    extra_dependencies += [libmpi]
endif

librobinhood = library(
    'robinhood',
    sources: [
        'alias.c',
        'backend.c',
        'config.c',
        'filter.c',
        'filters/core.c',
        'filters/parser.c',
        'fsentry.c',
        'fsevent.c',
        'hashmap.c',
        'id.c',
        'itertools.c',
        'list.c',
        'lu_fid.c',
        'plugin.c',
        'plugins/backend.c',
        'projection.c',
        'queue.c',
        'ring.c',
        'ringr.c',
        'serialization.c',
        'sstack.c',
        'stack.c',
        'statx.c',
        'uri.c',
        'utils/path.c',
        'utils/uri.c',
        'utils/regex.c',
        'utils/utils.c',
        'utils/open.c',
        'value.c',
    ] + extra_sources,
    version: meson.project_version(),
    dependencies: [ libdl, miniyaml ] + extra_dependencies,
    include_directories: rbh_include,
    install: true,
    c_args: '-DHAVE_CONFIG_H',
)

librobinhood_dep = declare_dependency(
    link_with: librobinhood,
    include_directories: rbh_include
)

subdir('plugins')
