{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ddbba2c8_236589fe",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 8,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "One thing that is not mentioned in this design is how the new file is bound to the old data in the HSM backend. The relation between Lustre and the HSM backend is done using an xattr (for our copytools at least) where we store `\u003cfsname\u003e:\u003cfid\u003e`. If you create a new file in Lustre, you have a new FID. Which means that this breaks the releationship between Lustre and the HSM backend. Copytools usually have functionnalities to rebind new fids with old data. rbh-undelete (v3) is able to run the copytool\u0027s command to make sure that everything is aligned. You also have to set the appropriate xattr as mentionned previously.\n\nAlso, an interesting use case that I think is not yet supported by rbh3 is versionning. We could have an option to overwrite the current content of the file with the content in the HSM backend. With phobos for instance, we could list all the versions and restore the one we want.\n\nAnother aspect not discussed here is what if a new file was created with the same name ? Could we provide a different path to restore the file ?",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 8,
        "endChar": 12
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a53eb8fb_ed83074f",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "The file is not archived in the database. The metadata of the file is in the database but the content is stored elsewhere. For Lustre-HSM, it is stored in the HSM backend (e.g. Phobos or HPSS). In rbh3, there is the backup module that lets you store backups of your data in another filesystem. rbh-undelete in this case will simply copy back the file from the external filesystem.",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 13,
        "endChar": 17
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d46be04_db8d31a1",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "This is Lustre specific. rbh3 has a more generic import feature.",
      "range": {
        "startLine": 20,
        "startChar": 19,
        "endLine": 21,
        "endChar": 17
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7ee34d0_d352a9fd",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 27,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "Therefore is incorrect here.",
      "range": {
        "startLine": 27,
        "startChar": 0,
        "endLine": 27,
        "endChar": 9
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d764c0e_d09ae57a",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "In rbh3, you can pass the full path that you want to restore. What usually happens is that a user removes a file and wants to retrieve it. They ask the support team for the restoration giving the path(s) of the file(s) to restore. So in practice, it is expected that the admin running the command will have the full path. No need to do it relative to the root of the FS.",
      "range": {
        "startLine": 34,
        "startChar": 63,
        "endLine": 35,
        "endChar": 36
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07d240c2_ec506d76",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 37,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "typo: store",
      "range": {
        "startLine": 37,
        "startChar": 47,
        "endLine": 37,
        "endChar": 53
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4310ffa_80ec033c",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 40,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "Regarding my previous comment, I don\u0027t think this is an issue. You can expect users to provide the full path. And I would argue that it is less confusing to use the full path for something like this.",
      "range": {
        "startLine": 37,
        "startChar": 0,
        "endLine": 40,
        "endChar": 55
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc68f97b_32a5a355",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 46,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "Another important info is the deletion time. Or at least the time when robinhood saw that the file was removed.\nold_path might be confusing. Maybe something like this would be better: `\"ns\": { \"xattrs\": { \"rm\": {\"time\": 1234, \"path\": \"/foo\" } } }`",
      "range": {
        "startLine": 46,
        "startChar": 1,
        "endLine": 46,
        "endChar": 9
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a7c3b07_a4db5bc0",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "typo: store",
      "range": {
        "startLine": 47,
        "startChar": 12,
        "endLine": 47,
        "endChar": 18
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "488e17b7_1880fcc4",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "Why is this optional?",
      "range": {
        "startLine": 55,
        "startChar": 47,
        "endLine": 55,
        "endChar": 57
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ddd0c3c3_2f4b00b9",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 60,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "You should also allow restoring a directory",
      "range": {
        "startLine": 60,
        "startChar": 3,
        "endLine": 60,
        "endChar": 14
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c0cc26a_c896c4a5",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 63,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "What is the point of having both the name and the path?\n\nYou should also add the rm time in the output.\n\nFor lustre, undelete by FID must be supported as well.\n\nFor instance: `rbh-undelete rbh:mongo:myfs -R \u003cfid\u003e path/to/new/destination`",
      "range": {
        "startLine": 63,
        "startChar": 4,
        "endLine": 63,
        "endChar": 23
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4f7b972_6210bbea",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 79,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "Instead of this sentence that does not really provide additional info, you can simply say what this URI will refer to.",
      "range": {
        "startLine": 77,
        "startChar": 0,
        "endLine": 79,
        "endChar": 14
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7816053_5e74155a",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 100,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "typo: Lustre not Lustre\u0027s",
      "range": {
        "startLine": 100,
        "startChar": 44,
        "endLine": 100,
        "endChar": 52
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4931bc68_d3b4cdf8",
        "filename": "designs/rbh-undelete.rst",
        "patchSetId": 1
      },
      "lineNbr": 104,
      "author": {
        "id": 1019142
      },
      "writtenOn": "2025-05-13T14:45:12Z",
      "side": 1,
      "message": "This is vary vague. In the current state of librobinhood this is not possible as there is no mecanism to import a file from the backend. This design does not mention the features required in librobinhood\u0027s backend API to add this feature. This should be discussed.",
      "range": {
        "startLine": 102,
        "startChar": 49,
        "endLine": 104,
        "endChar": 65
      },
      "revId": "9ba4dfd65e71e62f27fc380e80a5c2db22e5ae03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}